function userLogout(){$.ajax({url:"/user/logout",success:function(){}})}function userGetInfo(){$.ajax({url:"/user/getprofile",success:function(e){e.email?displayProfile(e):$(".user-login").show()}})}function displayProfile(e){$(".user-info").html(e.displayName)}function getCheckinLocation(){console.log("geolocating"),navigator.geolocation||console.log("Geolocation is not available"),map.locate();var e=L.mapbox.featureLayer().addTo(map);map.on("locationfound",function(o){forwardGeocode(o.latlng.lat,o.latlng.lng),console.log("location found"),map.setView([o.latlng.lat,o.latlng.lng],16),e.setGeoJSON({type:"Feature",geometry:{type:"Point",coordinates:[o.latlng.lng,o.latlng.lat]},properties:{title:"Here I am!","marker-color":"#04A195","marker-symbol":"rocket"}})}),map.on("locationerror",function(){console.log("Position could not be found")})}function forwardGeocode(e,o){checkinObj.addressLat=e,checkinObj.addressLng=o,$.ajax({url:"https://api.mapbox.com/v4/geocode/mapbox.places/"+o+","+e+".json?access_token="+mapboxToken,success:function(e){displayCheckinData(e)}})}function displayCheckinData(e){checkinObj.addressFull=e.features[0].place_name,checkinObj.addressNumber=e.features[0].address,checkinObj.addressShort=e.features[0].text,checkinObj.addressCity=e.features[1].text,console.log(checkinObj),$(".checkin-info .address").append(checkinObj.addressNumber+" "+checkinObj.addressShort)}function submitCheckinData(){console.log(checkinObj),$.ajax({method:"POST",url:"/mapdata/addtrucklocation",data:checkinObj,success:function(e){window.location="/"}})}function checkinMapHeight(){var e=$(".checkin-map-container").innerHeight(),o=$(".checkin-map-container h2").outerHeight();e-=o,$("#map").css("height",e+"px")}var mapboxToken="pk.eyJ1IjoianJrZWNrIiwiYSI6IjgzZTA0NmVhOGUxMjc2NjhmODYwYmQ3ZGIyZTRkOWQ1In0.XM9mizd6bF8zCqwafrGLDQ";$(document).ready(function(){userGetInfo(),$(".user-logout").on("click",function(){userLogout()})});var checkinObj={};L.mapbox.accessToken=mapboxToken;var map=L.mapbox.map("map","jrkeck.7fbfb356");map.setView([44.98,-93.2638],13),getCheckinLocation(),$(document).ready(function(){$("body").on("click",".send-location",function(){console.log("click event"),submitCheckinData()}),checkinMapHeight(),$(window).resize(function(){checkinMapHeight()})});