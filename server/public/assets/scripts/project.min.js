function userLogout(){$.ajax({url:"/user/logout",success:function(){}})}function userGetInfo(){$.ajax({url:"/user/getprofile",success:function(e){e.email?displayProfile(e):$(".user-login").show()}})}function displayProfile(e){$(".user-info").html(e.displayName)}function trucksNearbyHeight(){var e=$(".map-container").height(),a=$(".trucks-nearby").css("margin-top");a=parseInt(a);var t=e-2*a;$(".trucks-nearby").css("max-height",t+"px"),truckListingHeight()}function truckListingHeight(){$(".truck-listing").css("max-height","");var e=parseInt($(".trucks-nearby").height()),a=parseInt($(".trucks-nearby-header").outerHeight(!0)),t=parseInt($(".trucks-nearby-footer").outerHeight(!0)),o=e-(a+t);o+="px",$(".truck-listing").css("max-height",o)}function getMarkerData(){$.ajax({url:"/mapdata/getmarkers",success:function(e){return mapMarkers=e,populateMap(mapMarkers),e}})}function geolocateUser(){console.log("geolocating"),navigator.geolocation||console.log("Geolocation is not available"),map.locate();var e=L.mapbox.featureLayer().addTo(map);map.on("locationfound",function(a){console.log("location found"),map.setView([a.latlng.lat,a.latlng.lng],14),e.setGeoJSON({type:"Feature",geometry:{type:"Point",coordinates:[a.latlng.lng,a.latlng.lat]},properties:{title:"Here I am!","marker-color":"#04A195","marker-symbol":"rocket"}})}),map.on("locationerror",function(){console.log("Position could not be found")})}function populateMap(e){function a(e){for(var a=t.getElementsByTagName("div"),o=0;o<a.length;o++)a[o].className=a[o].className.replace(/active/,"").replace(/\s\s*$/,"");e.className+=" active"}var t=document.getElementById("listings"),o=L.mapbox.featureLayer().addTo(map);o.setGeoJSON(e),o.eachLayer(function(e){var o=e.feature.properties,n="<h3>"+o.truckName+"</h3><div>"+o.simpleAddress,r=t.appendChild(document.createElement("div"));r.className="truck";var i=r.appendChild(document.createElement("a"));i.href="#",i.className="truck-link",i.innerHTML="<h3>"+o.truckName+"</h3>",i.innerHTML+="<div class='address'>"+o.simpleAddress+"</div>",i.innerHTML+="<div class='city'>"+o.city+"</div>",i.onclick=function(){return a(r),map.setView(e.getLatLng(),16),e.openPopup(),!1},e.on("click",function(t){map.panTo(e.getLatLng()),a(r)}),n+="</div>",e.bindPopup(n),e.setIcon(L.icon({iconUrl:"/assets/images/map-markers/marker.png",iconSize:[65,50],iconAnchor:[0,0],popupAnchor:[0,-50]}))}),trucksNearbyHeight()}var mapboxToken="pk.eyJ1IjoianJrZWNrIiwiYSI6IjgzZTA0NmVhOGUxMjc2NjhmODYwYmQ3ZGIyZTRkOWQ1In0.XM9mizd6bF8zCqwafrGLDQ";$(document).ready(function(){console.log("Client script is loaded"),userGetInfo(),$(".user-logout").on("click",function(){userLogout()}),$(window).resize(function(){trucksNearbyHeight()})});var mapMarkers;L.mapbox.accessToken=mapboxToken;var map=L.mapbox.map("map","jrkeck.7fbfb356");map.setView([44.98,-93.2638],14),geolocateUser(),getMarkerData();