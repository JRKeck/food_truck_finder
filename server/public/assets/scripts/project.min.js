function userLogout(){$.ajax({url:"/user/logout",success:function(){}})}function userGetInfo(){$.ajax({url:"/user/getprofile",success:function(e){e.email?displayProfile(e):$(".user-login").show()}})}function displayProfile(e){$(".user-info").html(e.displayName)}function trucksNearbyHeight(){var e=$(".map-container").height(),a=$(".trucks-nearby").css("margin-top");a=parseInt(a);var t=e-2*a;$(".trucks-nearby").css("max-height",t+"px"),truckListingHeight()}function truckListingHeight(){$(".truck-listing").css("max-height","");var e=parseInt($(".trucks-nearby").height()),a=parseInt($(".trucks-nearby-header").outerHeight(!0)),t=parseInt($(".trucks-nearby-footer").outerHeight(!0)),n=e-(a+t);n+="px",$(".truck-listing").css("max-height",n)}function getMarkerData(){$.ajax({url:"/mapdata/getmarkers",success:function(e){return mapMarkers=e,populateMap(mapMarkers),e}})}function geolocateUser(){console.log("geolocating"),navigator.geolocation||console.log("Geolocation is not available"),map.locate(),map.on("locationfound",function(e){console.log("location found"),map.setView([e.latlng.lat,e.latlng.lng],14)}),map.on("locationerror",function(){console.log("Position could not be found")})}function populateMap(e){function a(e){for(var a=t.getElementsByTagName("div"),n=0;n<a.length;n++)a[n].className=a[n].className.replace(/active/,"").replace(/\s\s*$/,"");e.className+=" active"}var t=document.getElementById("listings"),n=L.mapbox.featureLayer().addTo(map);n.setGeoJSON(e),n.eachLayer(function(e){var n=e.feature.properties,o="<h3>"+n.truckName+'</h3><div class="info">'+n.simpleAddress,r=t.appendChild(document.createElement("div"));r.className="truck";var i=r.appendChild(document.createElement("a"));i.href="#",i.className="truck-link",i.innerHTML="<h3>"+n.truckName+"</h3>",i.innerHTML+="<div class='address'>"+n.simpleAddress+"</div>",i.innerHTML+="<div class='city'>"+n.city+"</div></div>",i.onclick=function(){return a(r),map.setView(e.getLatLng(),16),e.openPopup(),!1},e.on("click",function(t){map.panTo(e.getLatLng(),16),a(r)}),o+="</div>",e.bindPopup(o),e.setIcon(L.icon({iconUrl:"/assets/images/map-markers/marker.png",iconSize:[66,50],iconAnchor:[33,50],popupAnchor:[0,-50]}))}),trucksNearbyHeight()}var mapboxToken="pk.eyJ1IjoianJrZWNrIiwiYSI6IjgzZTA0NmVhOGUxMjc2NjhmODYwYmQ3ZGIyZTRkOWQ1In0.XM9mizd6bF8zCqwafrGLDQ";$(document).ready(function(){userGetInfo(),$(".user-logout").on("click",function(){userLogout()})}),$(document).ready(function(){$(window).resize(function(){trucksNearbyHeight()}),$("body").on("click",".menu-close",function(){$(".trucks-nearby").removeClass("active")}),$("body").on("click",".footer-nav .map-list",function(){$(".trucks-nearby").toggleClass("active"),setTimeout(truckListingHeight,700)})});var mapMarkers;L.mapbox.accessToken=mapboxToken;var map=L.mapbox.map("map","jrkeck.7fbfb356");map.setView([44.98,-93.2638],14),geolocateUser(),getMarkerData();