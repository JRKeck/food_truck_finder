function getMarkerData(){$.ajax({url:"/mapdata/getmarkers",success:function(e){return mapMarkers=e,populateMap(mapMarkers),e}})}function geolocateUser(){map.locate();var e=L.mapbox.featureLayer().addTo(map);map.on("locationfound",function(a){map.setView([a.latlng.lat,a.latlng.lng],14),e.setGeoJSON({type:"Feature",geometry:{type:"Point",coordinates:[a.latlng.lng,a.latlng.lat]},properties:{title:"Here I am!","marker-color":"#04A195","marker-symbol":"rocket"}})})}function populateMap(e){function a(e){for(var a=t.getElementsByTagName("div"),r=0;r<a.length;r++)a[r].className=a[r].className.replace(/active/,"").replace(/\s\s*$/,"");e.className+=" active"}var t=document.getElementById("listings"),r=L.mapbox.featureLayer().addTo(map);r.setGeoJSON(e),r.eachLayer(function(e){var r=e.feature.properties,n="<h3>"+r.truckName+"</h3><div>"+r.simpleAddress,o=t.appendChild(document.createElement("div"));o.className="truck";var c=o.appendChild(document.createElement("a"));c.href="#",c.className="truck-link",c.innerHTML="<h3>"+r.truckName+"</h3>",c.innerHTML+="<div class='address'>"+r.simpleAddress+"</div>",c.innerHTML+="<div class='city'>"+r.city+"</div>",c.onclick=function(){return a(o),map.setView(e.getLatLng(),16),e.openPopup(),!1},e.on("click",function(t){map.panTo(e.getLatLng()),a(o)}),n+="</div>",e.bindPopup(n)})}var mapMarkers;L.mapbox.accessToken="pk.eyJ1IjoianJrZWNrIiwiYSI6IjgzZTA0NmVhOGUxMjc2NjhmODYwYmQ3ZGIyZTRkOWQ1In0.XM9mizd6bF8zCqwafrGLDQ";var map=L.mapbox.map("map","jrkeck.7fbfb356");map.setView([44.98,-93.2638],14),getMarkerData(),$(document).ready(function(){console.log("Client stript is loaded")});