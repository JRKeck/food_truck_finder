function getMarkerData(){$.ajax({url:"/mapdata/getmarkers",success:function(e){return mapMarkers=e,populateMap(mapMarkers),e}})}function geolocateUser(){map.locate();var e=L.mapbox.featureLayer().addTo(map);map.on("locationfound",function(a){map.setView([a.latlng.lat,a.latlng.lng],14),e.setGeoJSON({type:"Feature",geometry:{type:"Point",coordinates:[a.latlng.lng,a.latlng.lat]},properties:{title:"Here I am!","marker-color":"#04A195","marker-symbol":"rocket"}})})}function populateMap(e){function a(e){for(var a=t.getElementsByTagName("div"),r=0;r<a.length;r++)a[r].className=a[r].className.replace(/active/,"").replace(/\s\s*$/,"");e.className+=" active"}var t=document.getElementById("listings"),r=L.mapbox.featureLayer().addTo(map);r.setGeoJSON(e),r.eachLayer(function(e){var r=e.feature.properties,n="<h3>"+r.truckName+"</h3><div>"+r.simpleAddress,i=t.appendChild(document.createElement("div"));i.className="truck";var s=i.appendChild(document.createElement("a"));s.href="#",s.className="truck-link",s.innerHTML="<h3>"+r.truckName+"</h3>",s.innerHTML+="<div class='address'>"+r.simpleAddress+"</div>",s.innerHTML+="<div class='city'>"+r.city+"</div>",s.onclick=function(){return a(i),map.setView(e.getLatLng(),16),e.openPopup(),!1},e.on("click",function(t){map.panTo(e.getLatLng()),a(i)}),n+="</div>",e.bindPopup(n),e.setIcon(L.icon({iconUrl:"/assets/images/map-markers/marker.png",iconSize:[65,50],iconAnchor:[33,50],popupAnchor:[0,-50]}))}),trucksNearbyHeight()}function getUserInfo(){$.ajax({url:"/user/profile",success:function(e){e.username?($(".user-login").remove(),displayProfile(e)):$(".user-login").show()}})}function displayProfile(e){$(".user-info").html(e.username)}function trucksNearbyHeight(){var e=$(".map-container").height(),a=$(".trucks-nearby").css("margin-top");a=parseInt(a);var t=e-2*a;$(".trucks-nearby").css("max-height",t+"px"),truckListingHeight()}function truckListingHeight(){$(".truck-listing").css("max-height","");var e=parseInt($(".trucks-nearby").height()),a=parseInt($(".trucks-nearby-header").outerHeight(!0)),t=parseInt($(".trucks-nearby-footer").outerHeight(!0)),r=e-(a+t);r+="px",$(".truck-listing").css("max-height",r)}var mapMarkers;L.mapbox.accessToken="pk.eyJ1IjoianJrZWNrIiwiYSI6IjgzZTA0NmVhOGUxMjc2NjhmODYwYmQ3ZGIyZTRkOWQ1In0.XM9mizd6bF8zCqwafrGLDQ";var map=L.mapbox.map("map","jrkeck.7fbfb356");map.setView([44.98,-93.2638],14),getMarkerData(),$(document).ready(function(){console.log("Client stript is loaded"),getUserInfo(),$(window).resize(function(){trucksNearbyHeight()})});